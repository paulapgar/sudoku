(()=>{"use strict";class e{constructor(){this._knownNum=0,this._possNums=new Map([])}populatePossNums(e){for(let l=1;l<=e;l++)this._possNums.set(l,!0)}clearPossNums(){this._possNums.clear()}hasPossNum(e){return this._possNums.has(e)}getPossNums(){return Array.from(this._possNums.keys())}onePossNumLeft(){return 1===this._possNums.size?Array.from(this._possNums.keys())[0]:0}removePossNum(e){this._possNums.delete(e)}get knownNum(){return this._knownNum}set knownNum(e){this._knownNum=e,this._possNums.clear()}}const l=document.getElementById("OriginalPuzzle"),n=document.getElementById("ScannedPuzzle");class t{static appendText(e,l){e.value+=l+"\n"}}class s{constructor(l){switch(this._boardSize=0,this._blockSize=0,this._needEval=!1,this._setupDone=!1,this._cells=new Map([]),this._boardSize=l,this._boardSize){case 9:this._blockSize=3;break;case 16:this._blockSize=4;break;default:console.log("Invalid boardSize!")}for(let n=0;n<l;n++)for(let t=0;t<l;t++){let s=new e;s.populatePossNums(l),this._cells.set(this.getCellNum(n,t),s)}}getCellNum(e,l){return e*this._boardSize+l}getCell(e,l){return this._cells.get(this.getCellNum(e,l))}setCellKnown(e,l,s){this.getCell(e,l).knownNum=s,this.needEval=!0,!0===this.setupDone&&t.appendText(n,"Set cell ("+e+","+l+") to "+s),this.clearColumn(e,s),this.clearRow(l,s),this.clearBlock(e,l,s)}clearColumn(e,l){for(let n=0;n<this._boardSize;n++)this.getCell(e,n).removePossNum(l)}clearRow(e,l){for(let n=0;n<this._boardSize;n++)this.getCell(n,e).removePossNum(l)}clearBlock(e,l,n){let t=Math.floor(e/this._blockSize)*this._blockSize,s=Math.floor(l/this._blockSize)*this._blockSize;for(let o=t;o<t+this._blockSize;o++)for(let t=s;t<s+this._blockSize;t++)o===e&&t===l||this.getCell(o,t).removePossNum(n)}processBoardOnePossible(){for(let e=0;e<this._boardSize;e++)for(let l=0;l<this._boardSize;l++){let n=this.getCell(e,l).onePossNumLeft();if(n>0)return this.setCellKnown(e,l,n),!0}return!1}processBoardBlockSingleNumber(){let e,l;e=this._boardSize/this._blockSize,l=this._boardSize/this._blockSize;for(let n=0;n<e;n++)for(let t=0;t<l;t++){let s=new Map;for(let e=1;e<=this._boardSize;e++)s.set(e,[]);for(let o=n*e;o<n*e+e;o++)for(let e=t*l;e<t*l+l;e++)0===this.getCell(o,e).knownNum&&this.getCell(o,e).getPossNums().forEach((l=>{let n=s.get(l);n.push([o,e]),s.set(l,n)}));for(let e=1;e<=this._boardSize;e++){let l=s.get(e);if(1===l.length)return this.setCellKnown(l[0][0],l[0][1],e),!0}}return!1}processBoardStep(){this.needEval=!1,t.appendText(n,"Scanner #1 try"),this.processBoardBlockSingleNumber()||(t.appendText(n,"Scanner #2 try"),this.processBoardOnePossible())}printBoard(e){let l,n,s=this._boardSize>9?2:1;for(let o=0;o<this._boardSize;o++){let w=[];for(let e=0;e<this._boardSize;e++)l=this.getCell(e,o),l.knownNum>0?(n=l.knownNum.toString(),w.push("["+" ".repeat(s-n.length)+n+"]")):w.push("["+" ".repeat(s)+"]");t.appendText(e,w.join(""))}}get setupDone(){return this._setupDone}set setupDone(e){this._setupDone=e}get needEval(){return this._needEval}set needEval(e){this._needEval=e}}let o;const w=document.getElementById("puzzles");w.addEventListener("change",(function(){"Choose"!==w.value&&(o=function(e){let l;switch(e){case"Puzzle1":return l=new s(9),l.setCellKnown(1,0,6),l.setCellKnown(7,0,1),l.setCellKnown(0,1,1),l.setCellKnown(3,1,2),l.setCellKnown(6,1,7),l.setCellKnown(8,1,3),l.setCellKnown(3,2,6),l.setCellKnown(5,2,9),l.setCellKnown(7,2,8),l.setCellKnown(1,3,7),l.setCellKnown(2,3,5),l.setCellKnown(6,3,9),l.setCellKnown(4,4,5),l.setCellKnown(2,5,2),l.setCellKnown(6,5,5),l.setCellKnown(7,5,4),l.setCellKnown(1,6,8),l.setCellKnown(3,6,1),l.setCellKnown(5,6,6),l.setCellKnown(0,7,5),l.setCellKnown(2,7,3),l.setCellKnown(5,7,2),l.setCellKnown(8,7,8),l.setCellKnown(1,8,9),l.setCellKnown(7,8,2),l;case"Puzzle38":return l=new s(9),l.setCellKnown(1,0,1),l.setCellKnown(3,0,7),l.setCellKnown(5,0,8),l.setCellKnown(6,0,9),l.setCellKnown(0,1,3),l.setCellKnown(5,1,9),l.setCellKnown(7,1,8),l.setCellKnown(4,2,5),l.setCellKnown(5,2,2),l.setCellKnown(8,2,6),l.setCellKnown(0,3,8),l.setCellKnown(4,3,7),l.setCellKnown(6,3,2),l.setCellKnown(7,3,4),l.setCellKnown(8,3,9),l.setCellKnown(2,4,4),l.setCellKnown(3,4,8),l.setCellKnown(4,4,9),l.setCellKnown(5,4,3),l.setCellKnown(6,4,1),l.setCellKnown(0,5,9),l.setCellKnown(1,5,5),l.setCellKnown(2,5,7),l.setCellKnown(4,5,4),l.setCellKnown(8,5,3),l.setCellKnown(0,6,7),l.setCellKnown(3,6,9),l.setCellKnown(4,6,2),l.setCellKnown(1,7,6),l.setCellKnown(3,7,3),l.setCellKnown(8,7,2),l.setCellKnown(2,8,9),l.setCellKnown(3,8,6),l.setCellKnown(5,8,5),l.setCellKnown(7,8,7),l;case"Puzzle88":return l=new s(9),l.setCellKnown(4,0,9),l.setCellKnown(7,0,7),l.setCellKnown(2,1,8),l.setCellKnown(8,1,3),l.setCellKnown(1,2,4),l.setCellKnown(5,2,6),l.setCellKnown(0,3,9),l.setCellKnown(4,3,1),l.setCellKnown(6,3,6),l.setCellKnown(0,4,1),l.setCellKnown(3,4,5),l.setCellKnown(5,4,3),l.setCellKnown(8,4,8),l.setCellKnown(2,5,4),l.setCellKnown(4,5,7),l.setCellKnown(8,5,2),l.setCellKnown(3,6,7),l.setCellKnown(7,6,8),l.setCellKnown(0,7,6),l.setCellKnown(6,7,7),l.setCellKnown(1,8,3),l.setCellKnown(4,8,4),l.setCellKnown(5,8,8),l.setCellKnown(3,0,1),l;case"Puzzle94":return l=new s(9),l.setCellKnown(1,0,3),l.setCellKnown(2,0,1),l.setCellKnown(0,1,7),l.setCellKnown(2,1,8),l.setCellKnown(4,1,2),l.setCellKnown(8,1,1),l.setCellKnown(3,2,8),l.setCellKnown(6,2,4),l.setCellKnown(1,3,7),l.setCellKnown(4,3,3),l.setCellKnown(5,3,6),l.setCellKnown(1,4,4),l.setCellKnown(2,4,6),l.setCellKnown(6,4,2),l.setCellKnown(7,4,3),l.setCellKnown(3,5,5),l.setCellKnown(4,5,7),l.setCellKnown(7,5,4),l.setCellKnown(2,6,5),l.setCellKnown(5,6,8),l.setCellKnown(0,7,6),l.setCellKnown(4,7,5),l.setCellKnown(6,7,1),l.setCellKnown(8,7,2),l.setCellKnown(6,8,3),l.setCellKnown(7,8,6),l;case"Puzzle174":return l=new s(9),l.setCellKnown(2,0,8),l.setCellKnown(6,0,4),l.setCellKnown(3,1,4),l.setCellKnown(5,1,5),l.setCellKnown(0,2,9),l.setCellKnown(2,2,7),l.setCellKnown(6,2,2),l.setCellKnown(8,2,6),l.setCellKnown(1,3,6),l.setCellKnown(4,3,3),l.setCellKnown(7,3,7),l.setCellKnown(3,4,8),l.setCellKnown(4,4,5),l.setCellKnown(5,4,9),l.setCellKnown(1,5,8),l.setCellKnown(4,5,7),l.setCellKnown(7,5,1),l.setCellKnown(0,6,1),l.setCellKnown(2,6,4),l.setCellKnown(6,6,3),l.setCellKnown(8,6,8),l.setCellKnown(3,7,2),l.setCellKnown(5,7,3),l.setCellKnown(2,8,6),l.setCellKnown(6,8,7),l;case"Puzzle245":return l=new s(9),l.setCellKnown(5,0,7),l.setCellKnown(6,0,5),l.setCellKnown(0,1,5),l.setCellKnown(3,1,3),l.setCellKnown(0,2,6),l.setCellKnown(2,2,7),l.setCellKnown(8,2,2),l.setCellKnown(2,3,2),l.setCellKnown(5,3,3),l.setCellKnown(6,3,7),l.setCellKnown(4,4,5),l.setCellKnown(2,5,3),l.setCellKnown(3,5,4),l.setCellKnown(6,5,8),l.setCellKnown(0,6,3),l.setCellKnown(6,6,4),l.setCellKnown(8,6,8),l.setCellKnown(5,7,4),l.setCellKnown(8,7,9),l.setCellKnown(2,8,1),l.setCellKnown(3,8,5),l;case"Puzzle16x16":return l=new s(16),l.setCellKnown(1,0,3),l.setCellKnown(3,0,6),l.setCellKnown(5,0,2),l.setCellKnown(7,0,11),l.setCellKnown(10,0,14),l.setCellKnown(12,0,1),l.setCellKnown(0,1,16),l.setCellKnown(3,1,14),l.setCellKnown(8,1,8),l.setCellKnown(13,1,15),l.setCellKnown(0,2,13),l.setCellKnown(3,2,2),l.setCellKnown(6,2,12),l.setCellKnown(7,2,1),l.setCellKnown(8,2,6),l.setCellKnown(9,2,16),l.setCellKnown(12,2,10),l.setCellKnown(15,2,5),l.setCellKnown(2,3,10),l.setCellKnown(4,3,9),l.setCellKnown(6,3,5),l.setCellKnown(8,3,1),l.setCellKnown(9,3,3),l.setCellKnown(10,3,2),l.setCellKnown(13,3,16),l.setCellKnown(15,3,6),l.setCellKnown(0,4,4),l.setCellKnown(1,4,14),l.setCellKnown(5,4,1),l.setCellKnown(6,4,9),l.setCellKnown(9,4,10),l.setCellKnown(12,4,11),l.setCellKnown(13,4,5),l.setCellKnown(0,5,11),l.setCellKnown(1,5,2),l.setCellKnown(2,5,12),l.setCellKnown(4,5,13),l.setCellKnown(7,5,5),l.setCellKnown(9,5,14),l.setCellKnown(14,5,6),l.setCellKnown(15,5,9),l.setCellKnown(1,6,10),l.setCellKnown(3,6,3),l.setCellKnown(10,6,7),l.setCellKnown(11,6,13),l.setCellKnown(14,6,4),l.setCellKnown(15,6,2),l.setCellKnown(2,7,16),l.setCellKnown(4,7,7),l.setCellKnown(6,7,3),l.setCellKnown(10,7,6),l.setCellKnown(11,7,2),l.setCellKnown(12,7,13),l.setCellKnown(14,7,15),l.setCellKnown(1,8,15),l.setCellKnown(3,8,12),l.setCellKnown(4,8,4),l.setCellKnown(5,8,11),l.setCellKnown(9,8,6),l.setCellKnown(11,8,10),l.setCellKnown(13,8,7),l.setCellKnown(0,9,9),l.setCellKnown(1,9,11),l.setCellKnown(4,9,6),l.setCellKnown(5,9,5),l.setCellKnown(12,9,4),l.setCellKnown(14,9,12),l.setCellKnown(0,10,2),l.setCellKnown(1,10,5),l.setCellKnown(6,10,1),l.setCellKnown(8,10,15),l.setCellKnown(11,10,4),l.setCellKnown(13,10,8),l.setCellKnown(14,10,3),l.setCellKnown(15,10,14),l.setCellKnown(2,11,4),l.setCellKnown(3,11,1),l.setCellKnown(6,11,8),l.setCellKnown(9,11,2),l.setCellKnown(10,11,13),l.setCellKnown(14,11,10),l.setCellKnown(15,11,16),l.setCellKnown(0,12,10),l.setCellKnown(2,12,7),l.setCellKnown(5,12,6),l.setCellKnown(6,12,2),l.setCellKnown(7,12,9),l.setCellKnown(9,12,13),l.setCellKnown(11,12,3),l.setCellKnown(13,12,4),l.setCellKnown(0,13,5),l.setCellKnown(3,13,11),l.setCellKnown(6,13,13),l.setCellKnown(7,13,3),l.setCellKnown(8,13,2),l.setCellKnown(9,13,4),l.setCellKnown(12,13,14),l.setCellKnown(15,13,10),l.setCellKnown(2,14,3),l.setCellKnown(7,14,14),l.setCellKnown(12,14,8),l.setCellKnown(15,14,7),l.setCellKnown(3,15,4),l.setCellKnown(5,15,16),l.setCellKnown(8,15,12),l.setCellKnown(10,15,8),l.setCellKnown(12,15,15),l.setCellKnown(14,15,1),l}return new s(9)}(w.value),l.value="",n.value="",t.appendText(l,"Initial Board"),o.printBoard(l),o.setupDone=!0)})),document.getElementById("scan").addEventListener("click",(function(){if(o&&!1!==o.setupDone&&o){n.value="";let e=-1;for(;!0===o.needEval;)o.processBoardStep(),e++;t.appendText(n,"Finished With Board  ("+e+" moves)"),o.printBoard(n),n.scrollTop=n.scrollHeight,o.setupDone=!1}}))})();